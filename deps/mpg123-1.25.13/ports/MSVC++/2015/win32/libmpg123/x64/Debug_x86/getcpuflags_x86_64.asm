













































































































































































































































































































































































































































































































































































































































































	.text
	.balign 4
	.globl INT123_getcpuflags
INT123_getcpuflags:
	push	%rbp
	mov		%rsp, %rbp
	push	%rbx
	

	push	%rdi
	mov		%rcx, %rdi


	movl	$0, 12(%rdi)
	movl	$0, 16(%rdi)

	mov		$0x80000000, %eax
	cpuid
	cmp		$0x80000001, %eax
	jb		1f
	mov		$0x80000001, %eax
	cpuid
	movl	%edx, 12(%rdi)
1:
	mov		$0x00000001, %eax
	cpuid
	movl	%eax, (%rdi)
	movl	%ecx, 4(%rdi)
	movl	%edx, 8(%rdi)
	test	$0x04000000, %ecx
	jz		2f
	test	$0x08000000, %ecx
	jz		2f
	xor		%ecx, %ecx
	.byte	0x0f, 0x01, 0xd0 
	movl	%eax, 16(%rdi)
	movl	(%rdi), %eax
2:

	pop		%rdi

	pop		%rbx
	mov		%rbp, %rsp
	pop		%rbp
	ret
	

